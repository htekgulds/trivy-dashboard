import { ReportTypes } from '@/src/config'
import { k8sCustomObjects } from '@/src/api/k8s/config'

export default async function handler (req, res) {
  const reports = await k8sCustomObjects.listClusterCustomObject(
    'aquasecurity.github.io',
    'v1alpha1',
    ReportTypes.VULNERABILITY
  )

  const summary = reports.body.items.reduce(
    (sum, item) => sum + Object.values(item.report.summary).reduce((counts, c) => counts + c, 0),
    0
  )
  res.status(200).json(summary)
}
